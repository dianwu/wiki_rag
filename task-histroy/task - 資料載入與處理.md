# 第一階段任務：資料載入與處理

這是對 `plan.md` 中第一階段「資料載入與處理」的細化步驟，可作為開發的具體待辦清單。

### 1. 尋找與選擇資料檔案

- [x] **任務 1.1**: 實作一個函式，掃描 `data/` 目錄。
- [x] **任務 1.2**: 列出所有找到的 `.xml` 檔案，並讓使用者選擇一個（或自動選擇第一個）作為處理對象。
- [x] **任務 1.3**: 函式返回被選中 XML 檔案的完整路徑。

### 2. 載入並解析 XML

- [x] **任務 2.1**: 建立一個 `load_and_parse_xml(file_path)` 函式。
- [x] **任務 2.2**: 在函式內部，使用 `lxml.etree.iterparse` 以事件驅動的方式解析 XML，這樣可以高效處理大檔案而不會耗盡記憶體。
- [x] **任務 2.3**: 遍歷 XML 樹，專注於 `<page>` 元素。
- [x] **任務 2.4**: 對於每個 `<page>` 元素，提取其子元素 `<title>` 的文字內容和 `<revision><text>` 的文字內容。
- [x] **任務 2.5**: 將每個頁面的結果儲存為一個字典或簡單物件，例如 `{'title': '頁面標題', 'text': '頁面原始內容'}`。
- [x] **任務 2.6**: 函式最終返回一個包含所有頁面資料的列表 (List of dictionaries)。

### 3. 清理頁面內容

- [x] **任務 3.1**: 建立一個 `clean_mediawiki_text(raw_text)` 函式。
- [x] **任務 3.2**: 使用 `BeautifulSoup(raw_text, 'html.parser').get_text()` 來移除內嵌的 HTML 標籤。
- [x] **任務 3.3**: （進階）使用正則表達式 (regex) 清理剩餘的 MediaWiki 語法，例如：
    - `\[\[文件:.*?\].*?\]\]` 或 `\[\[圖片:.*?\].*?\]\]` (檔案/圖片連結)
    - `\{\{.*?\}\}` (模板)
    - `'''(.*?)'''` (粗體)
    - `''(.*?)''` (斜體)
    - `==(.*?)=` (章節標題)
- [x] **任務 3.4**: 遍歷從任務 2 得到的資料列表，對每個頁面的 `'text'` 應用此清理函式。

### 4. 分割文件 (Chunking)

- [x] **任務 4.1**: 從 `langchain_text_splitters` 匯入 `RecursiveCharacterTextSplitter`。
- [x] **任務 4.2**: 初始化一個 `RecursiveCharacterTextSplitter` 實例，設定合理的 `chunk_size` (例如 1000) 和 `chunk_overlap` (例如 100)。
- [x] **任務 4.3**: 建立一個 `split_documents` 函式，接收清理後的頁面資料列表。
- [x] **任務 4.4**: 在函式中，遍歷每個頁面資料，使用 `splitter.create_documents()` 方法將頁面內容分割成多個 `Document` 物件。
- [x] **任務 4.5**: 在呼叫 `create_documents` 時，傳入 `metadatas` 參數，將頁面標題等資訊 (`{'source': page['title']}`) 附加到每個分割後的 `Document` 中，以便追溯來源。
- [x] **任務 4.6**: 函式最終返回一個扁平化的 `Document` 物件列表，其中包含了所有頁面分割後的所有片段。